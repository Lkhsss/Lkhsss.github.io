{
    "version": "https://jsonfeed.org/version/1",
    "title": "LKHSS的Blog • All posts by \"rust\" tag",
    "description": "嗨嗨嗨",
    "home_page_url": "https://blog.lkhsss.cn",
    "items": [
        {
            "id": "https://blog.lkhsss.cn/%E7%BC%96%E7%A8%8B/Rust/rust-%E4%BD%BF%E7%94%A8config%E9%85%8D%E7%BD%AE%E7%A8%8B%E5%BA%8F/",
            "url": "https://blog.lkhsss.cn/%E7%BC%96%E7%A8%8B/Rust/rust-%E4%BD%BF%E7%94%A8config%E9%85%8D%E7%BD%AE%E7%A8%8B%E5%BA%8F/",
            "title": "Rust-使用config配置程序",
            "date_published": "2024-02-16T03:33:38.000Z",
            "content_html": "<p>在应用开发中，我们通常会将一些可变项放到配置文件中。</p>\n<p>此次将使用<code>config</code>来进行配置项的读取。</p>\n<h2 id=\"安装依赖项\">安装依赖项</h2>\n<p>config提供api，去一个字段一个字段的读取配置。但是有一种更高级地方法，那就是声明一个struct，然后config帮我们进行反序列化处理，如果字段有错，会直接报错<code>config::ConfigError</code>。此方法更安全，更rust，代码脉络也更强。、</p>\n<p>因为要反序列化，所以要为struct启用<code>Deserialize</code>的trait。故而还要引用serde，并启用<code>derive</code>特性。</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-toml\" data-language=\"toml\"><code class=\"language-toml\">[dependencies]\nconfig &#x3D; &quot;0.14.0&quot;\nserde &#x3D; &#123; version &#x3D; &quot;1.0.196&quot;, features &#x3D; [&quot;derive&quot;] &#125;</code></pre></div></figure>\n<p>或者使用：</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cargo add config serde -F serde&#x2F;derive</code></pre></div></figure>\n<h2 id=\"声明配置struct\">声明配置struct</h2>\n<p>此处的结构体为一个典型示例</p>\n<p><code>src/main.rs</code></p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-rust\" data-language=\"rust\"><code class=\"language-rust\">use serde::Deserialize;\n\n#[derive(Debug,Deserialize)]\npub struct AppConfig &#123;\n    address: String, &#x2F;&#x2F; 配置项地址\n    port: u16, &#x2F;&#x2F; 配置项端口\n    server_name: String, &#x2F;&#x2F; 配置项服务器名称\n    database_url: String, &#x2F;&#x2F; 配置项数据库URL\n    database_port: u16, &#x2F;&#x2F; 配置项数据库端口\n    database_user: String, &#x2F;&#x2F; 配置项数据库用户名\n    database_password: String, &#x2F;&#x2F; 配置项数据库密码\n    debug: bool, &#x2F;&#x2F; 是否启用应用的调试(debug)模式\n&#125;</code></pre></div></figure>\n<h2 id=\"创建配置文件\">创建配置文件</h2>\n<p>在程序根目录下创建一个<code>toml</code>文件。这里创建一个名为<code>config.toml</code>的文件。</p>\n<p><code>config.toml</code></p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-toml\" data-language=\"toml\"><code class=\"language-toml\"># 配置项地址\naddress&#x3D;&quot;0.0.0.0&quot;\n# 配置项端口\nport&#x3D;8080 \n# 配置项服务器名称\nserver_name&#x3D; &quot;这是一个config库的demo&quot;\n\n#配置项数据库URL\ndatabase_url&#x3D;&quot;0.0.0.0&quot;\n# 配置项数据库端口\ndatabase_port&#x3D;&quot;7890&quot;\n# 配置项数据库用户名\ndatabase_user&#x3D;&quot;root&quot;\n# 配置项数据库密码\ndatabase_password&#x3D;&quot;ABCabc12345678&quot;\n\n# 是否启用应用的调试(debug)模式\ndebug&#x3D;true </code></pre></div></figure>\n<h2 id=\"读取配置文件\">读取配置文件</h2>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-rust\" data-language=\"rust\"><code class=\"language-rust\">use config::&#123;Config, File&#125;;\nfn main() &#123;\n    let config &#x3D; Config::builder().add_source(File::with_name(&quot;config.toml&quot;)).build().expect(&quot;读取配置文件错误&quot;);;\n    let app_config: AppConfig &#x3D; config.try_deserialize()..expect(&quot;反序列化失败！&quot;);\n    println!(&quot;&#123;:#?&#125;&quot;, app_config); &#x2F;&#x2F; 输出配置信息\n&#125;</code></pre></div></figure>\n<p>输出如下：</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">AppConfig &#123;\n    address: &quot;0.0.0.0&quot;,\n    port: 8080,\n    server_name: &quot;这是一个config库的demo&quot;,\n    database_url: &quot;0.0.0.0&quot;,\n    database_port: 7890,\n    database_user: &quot;root&quot;,\n    database_password: &quot;ABCabc12345678&quot;,\n    debug: true,\n&#125;</code></pre></div></figure>\n<h2 id=\"完整代码\">完整代码</h2>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-none\"><code class=\"language-none\">├─src\n│  └─main.rs\n└─config.toml</code></pre></div></figure>\n<p><code>src/main.rs</code></p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-rust\" data-language=\"rust\"><code class=\"language-rust\">use config::&#123;Config, File&#125;;\nuse serde::Deserialize;\n\n#[derive(Debug,Deserialize)]\npub struct AppConfig &#123;\n    address: String, &#x2F;&#x2F; 配置项地址\n    port: u16, &#x2F;&#x2F; 配置项端口\n    server_name: String, &#x2F;&#x2F; 配置项服务器名称\n    database_url: String, &#x2F;&#x2F; 配置项数据库URL\n    database_port: u16, &#x2F;&#x2F; 配置项数据库端口\n    database_user: String, &#x2F;&#x2F; 配置项数据库用户名\n    database_password: String, &#x2F;&#x2F; 配置项数据库密码\n    debug: bool, &#x2F;&#x2F; 是否启用应用的调试(debug)模式\n&#125;\nfn main() &#123;\n    let config &#x3D; Config::builder().add_source(File::with_name(&quot;config.toml&quot;)).build().expect(&quot;读取配置文件错误&quot;);\n    let app_config: AppConfig &#x3D; config.try_deserialize().expect(&quot;反序列化失败！&quot;);\n    println!(&quot;&#123;:#?&#125;&quot;, app_config); &#x2F;&#x2F; 输出配置信息\n&#125;\n</code></pre></div></figure>\n<p><code>config.toml</code></p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-toml\" data-language=\"toml\"><code class=\"language-toml\"># 配置项地址\naddress&#x3D;&quot;0.0.0.0&quot;\n# 配置项端口\nport&#x3D;8080 \n# 配置项服务器名称\nserver_name&#x3D; &quot;这是一个config库的demo&quot;\n\n#配置项数据库URL\ndatabase_url&#x3D;&quot;0.0.0.0&quot;\n# 配置项数据库端口\ndatabase_port&#x3D;&quot;7890&quot;\n# 配置项数据库用户名\ndatabase_user&#x3D;&quot;root&quot;\n# 配置项数据库密码\ndatabase_password&#x3D;&quot;ABCabc12345678&quot;\n\n# 是否启用应用的调试(debug)模式\ndebug&#x3D;true </code></pre></div></figure>\n",
            "tags": [
                "编程",
                "Rust"
            ]
        },
        {
            "id": "https://blog.lkhsss.cn/%E7%BC%96%E7%A8%8B/Rust/rust%E5%9C%A8windows%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%B8%8B%E8%BD%BD%E8%BF%87%E6%85%A2%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/",
            "url": "https://blog.lkhsss.cn/%E7%BC%96%E7%A8%8B/Rust/rust%E5%9C%A8windows%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%B8%8B%E8%BD%BD%E8%BF%87%E6%85%A2%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/",
            "title": "Rust在Windows系统中下载过慢的解决方法",
            "date_published": "2023-08-15T03:23:36.000Z",
            "content_html": "<p>由于rust的官方服务器在中国访问很慢，所以在安装和更新的时候经常出现下载时卡住的情况。<br>\n这时应换源处理。</p>\n<h2 id=\"换源\">换源</h2>\n<h3 id=\"1-添加临时环境变量\">1.添加临时环境变量</h3>\n<h4 id=\"中科大镜像\">中科大镜像</h4>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">$ENV:RUSTUP_DIST_SERVER&#x3D;&#39;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static&#39;\n$ENV:RUSTUP_UPDATE_ROOT&#x3D;&#39;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static&#x2F;rustup&#39;</code></pre></div></figure>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">set RUSTUP_DIST_SERVER&#x3D;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static\nset RUSTUP_UPDATE_ROOT&#x3D;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;rust-static&#x2F;rustup</code></pre></div></figure>\n<h4 id=\"字节跳动镜像\">字节跳动镜像</h4>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">$ENV:RUSTUP_DIST_SERVER&#x3D;&#39;https:&#x2F;&#x2F;rsproxy.cn&#39;\n$ENV:RUSTUP_UPDATE_ROOT&#x3D;&#39;https:&#x2F;&#x2F;rsproxy.cn&#x2F;rustup&#39;</code></pre></div></figure>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">set RUSTUP_DIST_SERVER&#x3D;https:&#x2F;&#x2F;rsproxy.cn\nset RUSTUP_UPDATE_ROOT&#x3D;https:&#x2F;&#x2F;rsproxy.cn&#x2F;rustup</code></pre></div></figure>\n<p>这两行代码将会把rust的下载和更新源更改为中科大和字节跳动的镜像服务器</p>\n<h3 id=\"2-正常安装或更新Rust\">2.正常安装或更新Rust</h3>\n<p>不关闭刚刚打开的命令行，将工作目录定位到rust安装包的位置。</p>\n<p>运行：</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\">.\\rustup-init.exe</code></pre></div></figure>\n<p>或者更新</p>\n<figure><div class=\"code-wrapper\"><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">rustup update</code></pre></div></figure>\n",
            "tags": [
                "编程",
                "解决方案",
                "Rust"
            ]
        }
    ]
}